<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" /><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Dashboard do Servidor - Lily</title>
  <style>
    body{font-family:'Segoe UI',T sans-serif;background:#36393f;color:#fff;margin:0;padding:20px;display:flex;justify-content:center;align-items:flex-start;min-height:100vh;}
    .container{background:#2f3136;border-radius:12px;padding:30px;max-width:500px;width:90%;box-shadow:0 8px 20px rgba(0,0,0,0.3);}
    h1{margin-top:0;font-size:2rem;text-align:center;margin-bottom:25px;}
    label{display:block;margin-bottom:12px;font-weight:600;cursor:pointer;}
    input[type="checkbox"]{margin-right:10px;transform:scale(1.3);vertical-align:middle;cursor:pointer;}
    input[type="text"],textarea{width:100%;border-radius:8px;border:none;padding:10px;font-size:1rem;margin-bottom:20px;box-sizing:border-box;font-family:'Segoe UI',T sans-serif;}
    button{background:#5865F2;border:none;color:#fff;padding:12px 20px;border-radius:8px;cursor:pointer;font-weight:600;width:100%;font-size:1.1rem;transition:background .3s;}
    button:hover{background:#4752c4;}
    .status-msg{margin-top:15px;font-weight:600;text-align:center;}
    @media(max-width:480px){body{padding:10px;} .container{padding:20px;}}
  </style>
</head>
<body>
  <div class="container">
    <h1>Configurações do Servidor</h1>
    <form id="configForm">
      <label><input type="checkbox" id="welcome_enabled"/> Ativar mensagem de boas-vindas</label>
      <label for="welcome_channel">ID do canal de boas-vindas:</label>
      <input type="text" id="welcome_channel" placeholder="Ex: 123456789012345678"/>
      <label for="welcome_message">Mensagem de boas-vindas:</label>
      <textarea id="welcome_message" rows="3" placeholder="Ex: Bem-vindo(a) {user} ao {server}!"></textarea>
      <label><input type="checkbox" id="tickets_enabled"/> Ativar sistema de tickets</label>
      <button type="submit">Salvar Configurações</button>
      <p id="status" class="status-msg"></p>
    </form>
  </div>
  <script>
    const qp = k=>new URLSearchParams(location.search).get(k);
    async function loadConfig(gId){
      try{
        const r=await fetch(`/api/guild?id=${gId}`);
        if(!r.ok) throw '';
        const d=await r.json();
        document.getElementById('welcome_enabled').checked = d.welcome_enabled||false;
        document.getElementById('welcome_channel').value = d.welcome_channel||'';
        document.getElementById('welcome_message').value = d.welcome_message||'';
        document.getElementById('tickets_enabled').checked = d.tickets_enabled||false;
      }catch{
        const s=document.getElementById('status');
        s.textContent="Erro ao carregar configurações."; s.style.color="#f04747";
      }
    }
    async function saveConfig(gId,c){
      try{
        const r=await fetch(`/api/guild?id=${gId}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(c)});
        if(!r.ok) throw '';
        const s=document.getElementById('status');
        s.textContent="Configurações salvas com sucesso!"; s.style.color="#43b581";
      }catch{
        const s=document.getElementById('status');
        s.textContent="Erro ao salvar configurações."; s.style.color="#f04747";
      }
    }
    document.getElementById('configForm').onsubmit = async e=>{
      e.preventDefault();
      const gid=qp('id');
      if(!gid){ alert("ID do servidor ausente na URL."); return; }
      const cfg={
        welcome_enabled:document.getElementById('welcome_enabled').checked,
        welcome_channel:document.getElementById('welcome_channel').value.trim(),
        welcome_message:document.getElementById('welcome_message').value.trim(),
        tickets_enabled:document.getElementById('tickets_enabled').checked
      };
      if(cfg.welcome_channel && !/^\d+$/.test(cfg.welcome_channel)){
        alert("ID do canal deve conter apenas números."); return;
      }
      await saveConfig(gid,cfg);
    };
    window.onload = ()=>{
      const gid = qp('id');
      if(!gid){
        const s=document.getElementById('status');
        s.textContent="ID do servidor ausente na URL."; s.style.color="#f04747";
      } else loadConfig(gid);
    };
  </script>
</body>
</html>
