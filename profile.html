<!DOCTYPE html><html lang="pt-BR"><head><meta charset="UTF-8"><title>Perfil</title></head><body>
<button onclick="window.location='feed.html'">Voltar</button>
<h2 id="name"></h2><img id="ava" width="80"><p id="bio"></p>
<textarea id="nbio"></textarea><button onclick="saveBio()">Salvar bio</button>
<script>
const data = JSON.parse(localStorage.getItem('lilyData')||'{}');
const userQ = new URLSearchParams(location.search).get('user');
const me = data.user.username+'#'+data.user.discriminator;
const isMe = !userQ || userQ === me;

function load(){
  fetch(isMe ? '/api/users.js?user='+encodeURIComponent(JSON.stringify(data.user))
    : '/api/users.js?q='+encodeURIComponent(userQ))
    .then(r=>r.json()).then(u=>{
      document.getElementById('name').textContent = u.username;
      document.getElementById('bio').textContent = u.bio;
    });
}
function saveBio(){
  fetch('/api/users.js', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({user:data.user,bio:document.getElementById('nbio').value})
  }).then(load);
}
load();
</script>
</body></html>
