<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Perfil</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 600px;
    margin: 30px auto;
    background: #f0f0f0;
    padding: 15px;
  }
  button {
    background-color: #5865f2;
    border: none;
    color: white;
    padding: 8px 14px;
    margin-bottom: 15px;
    border-radius: 5px;
    cursor: pointer;
  }
  button:hover {
    background-color: #4752c4;
  }
  #profile-info {
    background: white;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 0 5px #aaa;
    text-align: center;
  }
  #profile-info img {
    border-radius: 50%;
    width: 100px;
    margin-bottom: 10px;
  }
  textarea {
    width: 100%;
    height: 80px;
    padding: 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
    resize: vertical;
  }
</style>
</head>
<body>

<button onclick="window.location='feed.html'">Voltar ao Feed</button>

<div id="profile-info">
  <h2 id="name"></h2>
  <img id="ava" alt="avatar" />
  <p id="bio"></p>
  <textarea id="nbio" placeholder="Escreva sua bio..."></textarea><br />
  <button onclick="saveBio()">Salvar Bio</button>
</div>

<script>
const data = JSON.parse(localStorage.getItem('lilyData') || '{}');
const userQ = new URLSearchParams(location.search).get('user');
const me = data.user.username + '#' + data.user.discriminator;
const isMe = !userQ || userQ === me;

function load() {
  if (isMe) {
    fetch('/api/users.js?user=' + encodeURIComponent(JSON.stringify(data.user)))
      .then(r => r.json())
      .then(u => {
        document.getElementById('name').textContent = u.username;
        document.getElementById('bio').textContent = u.bio;
        document.getElementById('nbio').value = u.bio;
        document.getElementById('ava').src = u.avatar;
      });
  } else {
    fetch('/api/users.js?q=' + encodeURIComponent(userQ))
      .then(r => r.json())
      .then(users => {
        if (users.length > 0) {
          const u = users[0];
          document.getElementById('name').textContent = u.username;
          document.getElementById('bio').textContent = u.bio || 'Sem bio';
          document.getElementById('nbio').style.display = 'none';
          document.querySelector('button').style.display = 'none';
          document.getElementById('ava').src = 'https://cdn.discordapp.com/embed/avatars/' + (Math.floor(Math.random() * 5)) + '.png';
        } else {
          document.getElementById('name').textContent = 'Usuário não encontrado';
          document.getElementById('bio').textContent = '';
          document.getElementById('nbio').style.display = 'none';
          document.querySelector('button').style.display = 'none';
          document.getElementById('ava').src = '';
        }
      });
  }
}

function saveBio() {
  const bio = document.getElementById('nbio').value;
  fetch('/api/users.js', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ user: data.user, bio })
  }).then(load);
}

load();
</script>

</body>
</html>
